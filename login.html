<script>
const STORAGE_KEY = "ykh_currentUserId";
const FALLBACK = {
  "users": [
    {
      "id": "ayse",
      "name": "Ayşe Yılmaz",
      "age": 27,
      "job": "Endüstri Mühendisi",
      "city": "İstanbul",
      "bio": "Kitap kurdu, toplu taşımada romantik tesadüflerin peşinde.",
      "photo": "",
      "interests": ["kitap","kahve","koşu","müzik"],
      "lastSeen": "2025-08-12 18:40"
    },
    {
      "id": "ali",
      "name": "Ali Demir",
      "age": 30,
      "job": "Yazılım Geliştirici",
      "city": "İstanbul",
      "bio": "Metroda denk geldiğimiz o kişi belki de sensin. Merhaba demek için küçük bir cesaret yeter.",
      "photo": "",
      "interests": ["bisiklet","sinema","oyun","tekno"],
      "lastSeen": "2025-08-16 08:25"
    }
  ]
};

function setStatus(msg) {
  document.getElementById("status").textContent = "Durum: " + msg;
}

async function loadUsers() {
  const candidates = ["data/users.json","./data/users.json","users.json","./users.json"];
  for(const url of candidates){
    try {
      const res = await fetch(url, {cache:"no-store"});
      if(res.ok){
        const data = await res.json();
        console.info("Kullanıcı verisi:", url);
        return data;
      }
    } catch(e) {
      console.warn("Yüklenemedi:", url, e);
    }
  }
  console.warn("FALLBACK kullanıldı");
  return FALLBACK;
}

function fillSelect(list) {
  const sel = document.getElementById("userSelect");
  sel.innerHTML = "";
  for(const u of list.users){
    const opt = document.createElement("option");
    opt.value = u.id;
    opt.textContent = ${u.name} — ${u.city||""};
    sel.appendChild(opt);
  }
}

(async function init() {
  setStatus("kullanıcılar yükleniyor…");
  const data = await loadUsers();
  fillSelect(data);
  setStatus("hazır");
})();

document.getElementById("btnLogin").addEventListener("click", ()=>{
  const id = document.getElementById("userSelect").value;
  if(!id) return setStatus("lütfen bir kullanıcı seç");
  localStorage.setItem(STORAGE_KEY, id);
  setStatus("giriş yapıldı → profil…");
  location.href = "profil.html";
});

document.getElementById("btnReset").addEventListener("click", ()=>{
  localStorage.removeItem(STORAGE_KEY);
  setStatus("seçim sıfırlandı");
});
</script>
