<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>Yarım Kalan Hikayeler — Giriş</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:#0f1222;color:#eef}
    .wrap{max-width:900px;margin:0 auto;padding:24px}
    header{padding:24px 0;text-align:center}
    h1{margin:0 0 6px;font-size:26px}
    .card{background:#171a2e;border:1px solid #263056;border-radius:12px;padding:18px}
    label{display:block;margin:8px 0 6px}
    select,button{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #2c3560;background:#0f1222;color:#eef}
    button{cursor:pointer;margin-top:12px;background:#3942a5;border-color:#4852c8}
    button:hover{filter:brightness(1.08)}
    .muted{opacity:.75}
    footer{opacity:.7;text-align:center;margin-top:18px;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Yarım Kalan Hikayeler</h1>
      <div class="muted">Giriş (kullanıcı seç)</div>
    </header>

    <div class="card">
      <label for="userSelect">Bir kullanıcı seç:</label>
      <select id="userSelect">
        <option value="">— Seç —</option>
      </select>
      <button id="btnLogin">Giriş Yap</button>
      <p id="status" class="muted" style="margin-top:10px"></p>
    </div>

    <footer>
      <small>Demo • Pi ile giriş akışı daha sonra eklenecek</small>
    </footer>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const selectEl = document.getElementById('userSelect');

    async function loadUsers(){
      try{
        statusEl.textContent = 'Kullanıcılar yükleniyor...';
        // Aynı origin ve aynı repo kökü içinde çalışır.
        const res = await fetch('data/users.json', {cache:'no-store'});
        if(!res.ok) throw new Error('users.json bulunamadı veya erişilemedi');
        const users = await res.json();
        users.forEach(u=>{
          const opt = document.createElement('option');
          opt.value = u.id;
          opt.textContent = ${u.ad} (${u.konum});
          selectEl.appendChild(opt);
        });
        statusEl.textContent = 'Hazır.';
      }catch(err){
        console.error(err);
        statusEl.textContent = 'Hata: Kullanıcı listesi yüklenemedi. (F12 > Console kontrol et)';
        alert('Hata: data/users.json erişilemiyor. Dosya yolunu doğrula.');
      }
    }

    document.getElementById('btnLogin').addEventListener('click', ()=>{
      const id = selectEl.value;
      if(!id){ alert('Lütfen bir kullanıcı seç.'); return; }
      // Hem URL param, hem de localStorage kaydı
      try{ localStorage.setItem('ykh_user_id', id); }catch(e){}
      // profil.html'e id ile git
      location.href = profil.html?id=${encodeURIComponent(id)};
    });

    loadUsers();
  </script>
</body>
</html>
