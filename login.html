<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <title>Yarım Kalan Hikayeler — Giriş</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:#0f1222;color:#eef}
    header{padding:20px;text-align:center}
    h1{margin:0;font-size:22px}
    .wrap{max-width:900px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:#171a2e;border:1px solid #263056;border-radius:12px;overflow:hidden;cursor:pointer;transition:transform .15s ease, box-shadow .15s ease}
    .card:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.35)}
    .ph{width:100%;height:160px;object-fit:cover;background:#22263f}
    .info{padding:12px}
    .name{font-weight:700;font-size:16px}
    .bio{opacity:.85;font-size:13px;margin-top:6px;line-height:1.35}
    .footer{opacity:.7;text-align:center;font-size:12px;padding:12px}
    .empty{padding:24px;text-align:center;opacity:.8}
  </style>
</head>
<body>
  <header><h1>Giriş (Kullanıcı Seç)</h1></header>
  <div class="wrap">
    <div id="list" class="grid" aria-live="polite"></div>
    <div id="empty" class="empty" hidden>Hiç kullanıcı bulunamadı.</div>
  </div>
  <div class="footer">Seçtiğin kişiyle <strong>profil</strong> sayfası otomatik açılır.</div>

  <script>
    // Basit yardımcılar
    const LS_KEY = 'ykh_current_user';

    function goProfile(id){
      try{ localStorage.setItem(LS_KEY, id); }catch(_){}
      // profil.html?id=... (query de koyuyoruz; profil.html önce query’yi okur)
      location.href = 'profil.html?id=' + encodeURIComponent(id);
    }

    async function loadUsers(){
      const cacheBust = 'v=' + Date.now(); // GitHub Pages cache sorunu için
      const res = await fetch('data/users.json?' + cacheBust);
      if(!res.ok) throw new Error('users.json yüklenemedi');
      const data = await res.json();
      return (data && Array.isArray(data.users)) ? data.users : [];
    }

    function render(users){
      const list = document.getElementById('list');
      const empty = document.getElementById('empty');
      list.innerHTML = '';
      if(users.length === 0){ empty.hidden = false; return; }
      empty.hidden = true;
      users.forEach(u=>{
        const card = document.createElement('div');
        card.className='card';
        card.tabIndex=0;
        card.onclick=()=>goProfile(u.id);
        card.onkeypress=(e)=>{ if(e.key==='Enter') goProfile(u.id); };

        const img = document.createElement('img');
        img.className='ph';
        img.alt = u.name || 'Kullanıcı';
        img.src = u.photo || 'assets/placeholder.jpg';

        const info = document.createElement('div');
        info.className='info';
        const nm = document.createElement('div'); nm.className='name'; nm.textContent=u.name || u.id;
        const bio = document.createElement('div'); bio.className='bio'; bio.textContent=u.bio || '...';

        info.appendChild(nm); info.appendChild(bio);
        card.appendChild(img); card.appendChild(info);
        list.appendChild(card);
      });
    }

    (async ()=>{
      try{
        const users = await loadUsers();
        render(users);
      }catch(err){
        console.error(err);
        document.getElementById('empty').hidden = false;
        document.getElementById('empty').textContent = 'Bir şeyler ters gitti. users.json bulunamadı.';
      }
    })();
  </script>
</body>
</html>
