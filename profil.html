<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profil</title>
  <style>
    body{font-family:system-ui;background:#ffd400;margin:0;text-align:center;padding:24px}
    .btn{display:inline-block;background:#222;color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none;margin:6px}
    #photo{width:150px;height:150px;object-fit:cover;border-radius:50%;background:#fff;margin:16px auto;display:block}
    small{color:#666}
    pre{white-space:pre-wrap;text-align:left;background:#fff;padding:12px;border-radius:8px;max-width:680px;margin:16px auto}
  </style>
</head>
<body>

  <div>
    <a class="btn" href="login.html">← Kullanıcı değiştir</a>
    <a class="btn" href="index.html">Ana sayfa</a>
    <a class="btn" id="cikis" href="#">Çıkış</a>
  </div>

  <h2 id="status">1) Sayfa yüklendi</h2>
  <img id="photo" alt="">
  <p id="name"></p>
  <p id="loc"></p>
  <p id="bal"></p>
  <div id="debug"></div>

  <script defer>
    const setStatus = t => { 
      const el = document.getElementById('status'); 
      if (el) el.textContent = t; 
      console.log('[STATUS]', t); 
    };

    window.onerror = (m, src, line, col, err) => {
      const box = document.getElementById('debug');
      if (box) box.innerHTML = <pre>HATA: ${m}\nKaynak: ${src}\nSatır: ${line}:${col}\n${err?.stack||''}</pre>;
    };

    (async () => {
      try {
        setStatus('2) ID aranıyor…');

        // 1) URL ?id varsa onu al, yoksa localStorage'a bak
        let id = Number(new URLSearchParams(location.search).get('id'));
        if (!id) {
          const saved = localStorage.getItem('secili_kullanici_id');
          if (saved) id = Number(saved);
        }

        if (!id) {
          setStatus('ID yok. 1 sn sonra giriş sayfasına gidiliyor…');
          setTimeout(()=>location.href='login.html', 900);
          return;
        }

        // 2) JSON’u TAM URL ile çek (HTML dönmesini engeller)
        setStatus('3) JSON çekiliyor…');
        const JSON_URL = 'https://eyupdogan1907.github.io/yarim-kalan-hikayeler/kullanicilar.json';
        const res = await fetch(JSON_URL, { cache:'no-store' });

        if (!res.ok) {
          setStatus('JSON yüklenemedi: ' + res.status);
          return;
        }

        // 3) İçerik gerçekten JSON mu? (HTML gelirse hata ver)
        const text = await res.text();
        if (text.trim().startsWith('<')) {
          throw new Error('JSON yerine HTML geldi. (Yanlış URL ya da 404)');
        }
        const users = JSON.parse(text);

        setStatus('4) Kullanıcı bulunuyor…');
        const u = users.find(x => Number(x.id) === id);
        if (!u) { setStatus('Kullanıcı bulunamadı'); return; }

        // 4) Ekrana yaz
        document.getElementById('name').textContent = u.ad;
        document.getElementById('photo').src  = 'https://eyupdogan1907.github.io/yarim-kalan-hikayeler/' + u.profilFoto;
        document.getElementById('photo').alt  = u.ad;
        document.getElementById('loc').textContent = 'Konum: ' + (u.konum ?? '-');
        document.getElementById('bal').textContent = 'Pi Bakiyesi: ' + (u.piBakiyesi ?? '-');

        setStatus('5) Tamam ✅');

        // 5) Çıkış
        document.getElementById('cikis').addEventListener('click', e=>{
          e.preventDefault();
          localStorage.removeItem('secili_kullanici_id');
          location.href='login.html';
        });

      } catch (e) {
        console.error(e);
        setStatus('Hata oluştu');
        const box = document.getElementById('debug');
        if (box) box.innerHTML = <pre>${e.stack||e}</pre>;
      }
    })();
  </script>
</body>
</html>

 
