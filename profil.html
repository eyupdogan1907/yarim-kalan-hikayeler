<script>
  const USERS_URL = "data/users.json";

  // ðŸ”‘ Hangi anahtarÄ± okuyacaÄŸÄ±mÄ±z:
  function getActiveUserId(){
    // URL'de ?id= varsa onu kullan
    const urlId = new URLSearchParams(location.search).get("id");
    if (urlId) return urlId;

    // Yeni sistem: login.html'in yazdÄ±ÄŸÄ± anahtar
    const lsId = localStorage.getItem("currentUserId");
    if (lsId) return lsId;

    // Eski sistemlerden kalma olabilir (temizlik)
    const old = localStorage.getItem("selectedUser") || localStorage.getItem("userId");
    return old;
  }

  async function loadProfile(){
    const id = getActiveUserId();
    if (!id) { location.href = "login.html"; return; }

    const res = await fetch(USERS_URL, {cache:"no-store"});
    const users = await res.json();

    const user = users.find(u => String(u.id) === String(id));
    if (!user) { 
      // yanlÄ±ÅŸ/eksikse giriÅŸ sayfasÄ±na dÃ¶n
      localStorage.removeItem("currentUserId");
      localStorage.removeItem("selectedUser");
      localStorage.removeItem("userId");
      location.href = "login.html";
      return;
    }

    // --- buradan sonrasÄ±: ekrana basma ---
    document.title = YarÄ±m Kalan Hikayeler â€” ${user.isim};
    document.getElementById("profile").innerHTML = `
      <div class="profile">
        <img class="ph" src="${user.foto}" alt="${user.isim}">
        <div>
          <h2>${user.isim}, ${user.yas}</h2>
          <p class="muted">${user.meslek} â€” ${user.sehir}</p>
          <p><b>Ãœniversite:</b> ${user.universite ?? "-"}</p>
          <p><b>Ä°lgi AlanlarÄ±:</b> ${(user.ilgi||[]).join(", ")}</p>
          <p>${user.hakkinda ?? ""}</p>
        </div>
      </div>`;
  }

  // Eski anahtar kalmÄ±ÅŸsa temizle (karÄ±ÅŸmasÄ±n):
  localStorage.removeItem("selectedUser");
  localStorage.removeItem("userId");

  // YÃ¼kle
  document.addEventListener("DOMContentLoaded", loadProfile);
</script>
