<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>Yarım Kalan Hikayeler — Profil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:#0f1222;color:#eef}
    header{padding:20px;text-align:center}
    h1{margin:0;font-size:22px}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .profile{display:grid;grid-template-columns:180px 1fr;gap:18px;align-items:start}
    .ph{width:180px;height:180px;border-radius:14px;object-fit:cover;background:#22263f;border:1px solid #263056}
    .card{background:#171a2e;border:1px solid #263056;border-radius:12px;padding:14px}
    .muted{opacity:.75}
    .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .tag{padding:6px 10px;border-radius:999px;background:#0f1222;border:1px solid #2b3560;font-size:13px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{padding:10px 12px;border-radius:10px;border:1px solid #2c3560;background:#0f1222;color:#eef;cursor:pointer}
    button.primary{background:#3942a5;border-color:#4852c8}
    @media (max-width:700px){
      .profile{grid-template-columns:1fr}
      .ph{width:100%;height:260px}
    }
  </style>
</head>
<body>
  <header>
    <h1>Profil</h1>
    <div class="muted">Seçtiğin kişi</div>
  </header>

  <div class="wrap">
    <div id="err" class="card" style="display:none"></div>

    <div class="card profile" id="profile" style="display:none">
      <img id="foto" class="ph" alt="Profil fotoğrafı"
           onerror="this.src='data:image/svg+xml;utf8,\
           &lt;svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22&gt;\
           &lt;rect width=%22100%25%22 height=%22100%25%22 fill=%22%2322263f%22/&gt;\
           &lt;text x=%22550%25%22 y=%2250%25%22 fill=%22%23aab%22 font-size=%2220%22 font-family=%22Arial%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22&gt;Foto yok&lt;/text&gt;\
           &lt;/svg&gt;';" />

      <div>
        <h2 id="ad" style="margin:0 0 6px 0"></h2>
        <div class="muted" id="meta"></div>
        <p id="bio" style="margin:10px 0 0 0"></p>
        <div class="tags" id="tags"></div>

        <div class="actions">
          <button class="primary" id="btnEsles">Eşleşme İsteği Gönder</button>
          <button id="btnGeri">Kullanıcı Seçimine Dön</button>
        </div>
      </div>
    </div>

    <div class="card">
      <small class="muted">
        İpucu: URL’de <code>?id=...</code> yoksa otomatik olarak <em>son seçilen</em> kullanıcıyı localStorage’tan yükler.
      </small>
    </div>
  </div>

  <!-- Failsafe: JSON yedeği -->
  <script type="application/json" id="usersData">
  [
    {"id":"1","ad":"Ayşe","yas":27,"konum":"İstanbul","meslek":"Öğretmen","bio":"Kitap kurdu, sakin.","ilgiAlanlari":["Kitap","Kahve","Yürüyüş"],"foto":"assets/ayse.jpg"},
    {"id":"2","ad":"Efe","yas":29,"konum":"İstanbul","meslek":"Grafik Tasarımcı","bio":"Indie rock seviyor.","ilgiAlanlari":["Müzik","Bisiklet","Tasarım"],"foto":"assets/efe.jpg"},
    {"id":"3","ad":"Zeynep","yas":25,"konum":"İstanbul","meslek":"Test Uzmanı","bio":"Sudoku sever, güler yüzlü.","ilgiAlanlari":["Bulmaca","Koşu","Kahvaltı"],"foto":"assets/zeynep.jpg"}
  ]
  </script>

  <script>
    const qs = new URLSearchParams(location.search);
    let userId = qs.get('id') || localStorage.getItem('ykh_user_id') || '';

    const elErr  = document.getElementById('err');
    const elProf = document.getElementById('profile');
    const elAd   = document.getElementById('ad');
    const elMeta = document.getElementById('meta');
    const elBio  = document.getElementById('bio');
    const elTags = document.getElementById('tags');
    const elFoto = document.getElementById('foto');

    if(!userId){ location.replace('login.html'); }

    async function getUsers(){
      // 1) Harici JSON
      try{
        const res = await fetch('data/users.json', {cache:'no-store'});
        if(!res.ok) throw new Error('users.json yok');
        return await res.json();
      }catch(e){
        console.warn('Harici JSON yok, yedek kullanılacak:', e.message);
      }
      // 2) Yerel yedek
      const txt = document.getElementById('usersData').textContent.trim();
      return JSON.parse(txt);
    }

    async function load(){
      try{
        const users = await getUsers();
        const u = users.find(x=> String(x.id) === String(userId));
        if(!u) throw new Error('Kullanıcı bulunamadı (id=' + userId + ')');

        elAd.textContent = u.ad;
        elMeta.textContent = [u.yas && (u.yas + ' yaş'), u.konum, u.meslek].filter(Boolean).join(' • ');
        elBio.textContent = u.bio || '';
        elFoto.src = u.foto || '';

        elTags.innerHTML = '';
        (u.ilgiAlanlari || []).forEach(t=>{
          const span = document.createElement('span');
          span.className = 'tag';
          span.textContent = t;
          elTags.appendChild(span);
        });

        elProf.style.display = '';
      }catch(err){
        console.error(err);
        elErr.style.display = '';
        elErr.textContent = 'Hata: ' + err.message + ' — (F12 > Network/Console kontrol et).';
      }
    }

    document.getElementById('btnGeri').onclick = ()=> location.href = 'login.html';
    document.getElementById('btnEsles').onclick = ()=> alert('Demo: Eşleşme isteği gönderildi.');

    load();
  </script>
</body>
</html>
