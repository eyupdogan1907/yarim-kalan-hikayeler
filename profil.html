<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>Profil • Yarım Kalan Hikayeler (Teşhis)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#fafafa;color:#111}
  header{display:flex;align-items:center;gap:8px;padding:12px 16px;border-bottom:1px solid #eee;background:#fff;position:sticky;top:0}
  header a{font-size:14px;color:#0a66ff;text-decoration:none}
  .wrap{max-width:860px;margin:20px auto;padding:0 16px}

  .hero{background:#eee;border-radius:12px;overflow:hidden;display:flex;justify-content:center;align-items:center;min-height:300px}
  .hero img{width:auto;height:auto;max-width:100%;max-height:80vh;object-fit:contain;display:block}

  .name{font-size:26px;font-weight:700;margin:16px 0 4px}
  .tags{color:#666;font-size:14px}
  .nav{margin-top:16px;display:flex;gap:10px}
  .btn{padding:10px 16px;border:1px solid #ddd;border-radius:10px;background:#fff;cursor:pointer}
  .btn:hover{background:#f5f5f5}

  .err{display:none;margin:12px 0;padding:10px;border:1px solid #f5c2c7;background:#f8d7da;color:#842029;border-radius:8px;white-space:pre-wrap}
  .info{margin-top:10px;padding:10px;background:#fff;border:1px dashed #ccc;border-radius:10px;font-size:13px;color:#333}
  .info code{background:#f3f3f3;padding:2px 6px;border-radius:6px}
</style>
</head>
<body>
<header><a href="index.html">← Anasayfa</a></header>

<div class="wrap">
  <div id="err" class="err"></div>

  <div class="hero"><img id="avatar" alt="Profil fotoğrafı"></div>

  <div class="name" id="name">Yükleniyor...</div>
  <div class="tags" id="tags"></div>

  <div class="nav">
    <button class="btn" id="prev">⟵ Önceki</button>
    <button class="btn" id="next">Sonraki ⟶</button>
  </div>

  <div class="info" id="diag" style="display:none"></div>
</div>

<!-- Pi yardımcıları (gerekliyse) -->
<script src="js/pi.js"></script>
<script>
const E = id => document.getElementById(id);
const errBox = E("err");
const diagBox = E("diag");

function showError(msg){
  errBox.textContent = msg;
  errBox.style.display = "block";
  console.error(msg);
}
function info(html){
  diagBox.innerHTML = html;
  diagBox.style.display = "block";
}

/* Global JS hata yakalayıcıları (ekranda görünsün) */
window.addEventListener("error", e=>{
  showError("JS Error: " + (e.message || e.error?.message || String(e)));
});
window.addEventListener("unhandledrejection", e=>{
  showError("Promise Error: " + (e.reason?.message || String(e.reason)));
});

let users = [];
let curId = Number(new URLSearchParams(location.search).get("id")) || 1;

function show(id){
  const u = users.find(x => Number(x.id) === Number(id)) || users[0];
  if(!u){ showError("Kullanıcı bulunamadı."); return; }
  curId = u.id;

  E("name").textContent = u.name || "(isimsiz)";
  E("tags").textContent = (u.tags || []).join(" • ");

  const img = E("avatar");
  const src = "assets/" + (u.photo || "");
  img.src = src;
  img.alt = u.name;
  img.onerror = () => { showError("Görsel yüklenemedi: " + src); };

  history.replaceState(null, "", "?id=" + encodeURIComponent(u.id));

  // TEŞHİS: görüntülenen URL'leri ve durumları yaz
  info(
    "JSON kaynağı: <code>data/users.json</code><br>" +
    "Seçilen id: <code>" + curId + "</code><br>" +
    "Fotoğraf dosyası adı: <code>" + (u.photo || "(boş)") + "</code><br>" +
    "Beklenen resim URL'i: <a href='" + src + "' target='_blank'><code>" + src + "</code></a>"
  );
}

fetch("data/users.json?v="+Date.now())
  .then(r=>{ if(!r.ok) throw new Error("users.json yüklenemedi (HTTP "+r.status+")"); return r.json(); })
  .then(list=>{
    if(!Array.isArray(list)) throw new Error("users.json bir liste ([]) değil.");
    users = list;
    show(curId);

    E("prev").onclick = ()=>{
      const i = users.findIndex(u=>Number(u.id)===Number(curId));
      const ni = (i-1+users.length)%users.length;
      show(users[ni].id);
    };
    E("next").onclick = ()=>{
      const i = users.findIndex(u=>Number(u.id)===Number(curId));
      const ni = (i+1)%users.length;
      show(users[ni].id);
    };
  })
  .catch(e=> showError("Hata: " + e.message));
</script>
</body>
</html>
