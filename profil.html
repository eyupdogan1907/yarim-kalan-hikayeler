<!doctype html>
<html lang="tr">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Profil</title>
<style>
  body{font-family:system-ui;background:#ffd400;text-align:center;margin:0;padding:24px}
  .btn{display:inline-block;background:#222;color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none;margin:6px}
  #photo{width:150px;height:150px;object-fit:cover;border-radius:50%;background:#fff;margin:16px auto;display:block}
</style>

<div>
  <a class="btn" href="login.html">← Kullanıcı değiştir</a>
  <a class="btn" href="index.html">Ana sayfa</a>
  <a class="btn" id="cikis" href="#">Çıkış</a>
</div>

<h2 id="name">Yükleniyor…</h2>
<img id="photo" alt="">
<p id="loc"></p>
<p id="bal"></p>

<script defer>
(async () => {
  try {
    // 1) URL'de id varsa onu, yoksa localStorage'daki seçimi kullan
    let id = Number(new URLSearchParams(location.search).get('id'));
    if (!id) {
      const saved = localStorage.getItem('secili_kullanici_id');
      if (saved) id = Number(saved);
    }
    if (!id) {            // hiçbiri yoksa login'e dön
      location.href = 'login.html';
      return;
    }

    // 2) Veriyi çek
    const base = 'https://eyupdogan1907.github.io/yarim-kalan-hikayeler/';
    const res  = await fetch(base + 'kullanicilar.json', { cache: 'no-store' });
    if (!res.ok) throw new Error('JSON yüklenemedi: ' + res.status);
    const users = await res.json();

    const u = users.find(x => Number(x.id) === id);
    if (!u) throw new Error('Kullanıcı bulunamadı');

    // 3) Ekrana yaz
    document.getElementById('name').textContent  = u.ad;
    document.getElementById('photo').src         = base + u.profilFoto;
    document.getElementById('photo').alt         = u.ad;
    document.getElementById('loc').textContent   = 'Konum: ' + (u.konum ?? '-');
    document.getElementById('bal').textContent   = 'Pi Bakiyesi: ' + (u.piBakiyesi ?? '-');

    // 4) Karşılaşmaları kaydet fonksiyonun varsa çağır (opsiyonel)
    if (typeof kaydetKarsilasma === 'function') kaydetKarsilasma(u);

    // 5) Çıkış: seçimi temizle ve login'e dön
    const btn = document.getElementById('cikis');
    if (btn) btn.addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('secili_kullanici_id');
      location.href = 'login.html';
    });

  } catch (e) {
    document.getElementById('name').textContent = 'Hata: ' + e.message;
    console.error(e);
  }
})();
</script>
